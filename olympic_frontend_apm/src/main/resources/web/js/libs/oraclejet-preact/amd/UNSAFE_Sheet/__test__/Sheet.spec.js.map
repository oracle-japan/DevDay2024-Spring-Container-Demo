{"version":3,"file":"Sheet.spec.js","sources":["../../../../src/UNSAFE_Sheet/__test__/Sheet.spec.tsx"],"sourcesContent":["import { fireEvent, render } from '@testing-library/preact';\n\nimport { ComponentProps } from 'preact';\n\nimport { RootEnvironmentProvider } from '../../UNSAFE_Environment';\nimport { expect } from 'chai';\nimport { spy } from 'sinon';\nimport { useRef } from 'preact/hooks';\nimport userEvent from '@testing-library/user-event';\nimport { BaseButton } from '../../UNSAFE_BaseButton';\nimport { Sheet } from '../Sheet';\nimport { getClientHints } from '../../utils/PRIVATE_clientHints';\n\n//TODO: JET-63873\nfunction getSheet(elem: Element) {\n  return elem.querySelector('#contentId') as HTMLElement;\n}\nfunction getSheetContainer(elem: Element) {\n  return (elem.querySelector('#contentId') as Element).parentElement as HTMLElement;\n}\n\nfunction getSheetScrim(sheetContainer: Element) {\n  return sheetContainer.parentElement?.parentElement?.parentElement?.firstElementChild;\n}\n\nconst SheetSimpleComponent = ({\n  onClose\n}: {\n  onClose?: ComponentProps<typeof Sheet>['onClose'];\n}) => {\n  const ref = useRef<HTMLButtonElement>(null);\n\n  return (\n    <>\n      <RootEnvironmentProvider>\n        <BaseButton ref={ref}>Open</BaseButton>\n        <Sheet isOpen={true} onClose={onClose}>\n          <div\n            style={{ display: 'flex', flexDirection: 'column', outlineStyle: 'none' }}\n            id=\"contentId\">\n            <h1>N1</h1>\n            <h1>N2</h1>\n            <h1>N3</h1>\n            <h1>N4</h1>\n          </div>\n        </Sheet>\n      </RootEnvironmentProvider>\n    </>\n  );\n};\n\ndescribe('Test Sheet Component', () => {\n  it('Sheet content render correctly', async function () {\n    const { container } = render(<SheetSimpleComponent />);\n\n    const sheetContent = getSheet(container);\n\n    expect(sheetContent).not.null;\n  });\n\n  it('onClose called when Escape or Tab are pressed', async function () {\n    const onActionDummyFunction = spy();\n    const { container } = render(<SheetSimpleComponent onClose={onActionDummyFunction} />);\n\n    const sheetContent = getSheet(container);\n    const sheetContainer = getSheetContainer(container);\n\n    expect(sheetContent).not.null;\n\n    fireEvent.keyDown(sheetContainer, { code: 'Tab' });\n    fireEvent.keyDown(sheetContainer, { code: 'Escape' });\n    expect(onActionDummyFunction.calledTwice).to.be.true;\n  });\n\n  it('onClose called when clicking scrim', async function () {\n    const onActionDummyFunction = spy();\n    const { container } = render(<SheetSimpleComponent onClose={onActionDummyFunction} />);\n    const sheetContent = getSheet(container);\n    const sheetContainer = getSheetContainer(container);\n    const sheetScrim = getSheetScrim(sheetContainer);\n\n    expect(sheetContent).not.null;\n\n    await userEvent.click(sheetScrim as HTMLElement);\n\n    expect(onActionDummyFunction.called).to.be.true;\n  });\n\n  it('onClose called when swipe is done (mobile)', async function () {\n    const onActionDummyFunction = spy();\n    const { container } = render(<SheetSimpleComponent onClose={onActionDummyFunction} />);\n    const sheetContent = getSheet(container);\n    const sheetContainer = getSheetContainer(container);\n    expect(sheetContent).not.null;\n\n    if (typeof jest === 'undefined' && getClientHints().touchSupport === 'primary') {\n      // Touch objects are created so we can replicate this in fake touch events\n      // This stuff is based on what useSwipe triggers and could change depending on the final decision\n      // on what events to trigger on useSwipe.\n      const touch1 = new Touch({\n        target: sheetContainer as EventTarget,\n        identifier: 0,\n        pageX: 386,\n        pageY: 224\n      });\n      const touch2 = new Touch({\n        target: sheetContainer as EventTarget,\n        identifier: 0,\n        pageX: 389,\n        pageY: 397\n      });\n      if (sheetContainer) {\n        fireEvent.touchStart(sheetContainer, {\n          timeStamp: 10406,\n          currentTarget: sheetContainer,\n          changedTouches: [touch1]\n        });\n        fireEvent.touchEnd(sheetContainer, {\n          timeStamp: 10472,\n          currentTarget: sheetContainer,\n          changedTouches: [touch2]\n        });\n      }\n      expect(onActionDummyFunction.called).to.be.true;\n    }\n  });\n});\n"],"names":["getSheet","elem","querySelector","getSheetContainer","parentElement","SheetSimpleComponent","onClose","ref","useRef","_jsx","_Fragment","children","_jsxs","jsxs","RootEnvironmentProvider","jsx","BaseButton","Sheet","isOpen","style","display","flexDirection","outlineStyle","id","describe","it","async","container","render","sheetContent","expect","not","null","onActionDummyFunction","spy","sheetContainer","fireEvent","keyDown","code","calledTwice","to","be","true","sheetScrim","firstElementChild","getSheetScrim","userEvent","click","called","jest","getClientHints","touchSupport","touch1","Touch","target","identifier","pageX","pageY","touch2","touchStart","timeStamp","currentTarget","changedTouches","touchEnd"],"mappings":"quEAcA,SAASA,GAASC,GAChB,OAAOA,EAAKC,cAAc,aAC5B,CACA,SAASC,GAAkBF,GACzB,OAAQA,EAAKC,cAAc,cAA0BE,aACvD,CAMA,MAAMC,GAAuB,EAC3BC,cAIA,MAAMC,EAAMC,SAA0B,MAEtC,OACEC,EAAAA,IACEC,EAAAA,SAAA,CAAAC,SAAAC,EAAAC,KAACC,EAAuBA,wBAAA,CAAAH,SAAA,CACtBF,EAACM,IAAAC,EAAUA,WAAC,CAAAT,IAAKA,EAAsBI,SAAA,SACvCF,EAAAA,IAACQ,EAAAA,MAAK,CAACC,QAAQ,EAAMZ,QAASA,EAAOK,SACnCC,EACEC,KAAA,MAAA,CAAAM,MAAO,CAAEC,QAAS,OAAQC,cAAe,SAAUC,aAAc,QACjEC,GAAG,YAAWZ,SAAA,CACdF,EAAAA,IAAW,KAAA,CAAAE,SAAA,OACXF,EAAWM,IAAA,KAAA,CAAAJ,SAAA,OACXF,EAAWM,IAAA,KAAA,CAAAJ,SAAA,OACXF,EAAAA,IAAW,KAAA,CAAAE,SAAA,gBAKnB,EAGJa,SAAS,wBAAwB,KAC/BC,GAAG,kCAAkCC,iBACnC,MAAMC,UAAEA,GAAcC,EAAMA,OAACnB,EAACM,IAAAV,GAAuB,CAAA,IAE/CwB,EAAe7B,GAAS2B,GAE9BG,EAAAA,OAAOD,GAAcE,IAAIC,IAC3B,IAEAP,GAAG,iDAAiDC,iBAClD,MAAMO,EAAwBC,EAAAA,OACxBP,UAAEA,GAAcC,EAAAA,OAAOnB,EAAAM,IAACV,GAAoB,CAACC,QAAS2B,KAEtDJ,EAAe7B,GAAS2B,GACxBQ,EAAiBhC,GAAkBwB,GAEzCG,EAAAA,OAAOD,GAAcE,IAAIC,KAEzBI,EAASA,UAACC,QAAQF,EAAgB,CAAEG,KAAM,QAC1CF,EAASA,UAACC,QAAQF,EAAgB,CAAEG,KAAM,WAC1CR,EAAMA,OAACG,EAAsBM,aAAaC,GAAGC,GAAGC,IAClD,IAEAjB,GAAG,sCAAsCC,iBACvC,MAAMO,EAAwBC,EAAAA,OACxBP,UAAEA,GAAcC,EAAAA,OAAOnB,EAAAM,IAACV,GAAoB,CAACC,QAAS2B,KACtDJ,EAAe7B,GAAS2B,GAExBgB,EA1DV,SAAuBR,GACrB,OAAOA,EAAe/B,eAAeA,eAAeA,eAAewC,iBACrE,CAwDuBC,CADI1C,GAAkBwB,IAGzCG,EAAAA,OAAOD,GAAcE,IAAIC,WAEnBc,GAAS,QAACC,MAAMJ,GAEtBb,EAAMA,OAACG,EAAsBe,QAAQR,GAAGC,GAAGC,IAC7C,IAEAjB,GAAG,8CAA8CC,iBAC/C,MAAMO,EAAwBC,EAAAA,OACxBP,UAAEA,GAAcC,EAAAA,OAAOnB,EAAAM,IAACV,GAAoB,CAACC,QAAS2B,KACtDJ,EAAe7B,GAAS2B,GACxBQ,EAAiBhC,GAAkBwB,GAGzC,GAFAG,EAAAA,OAAOD,GAAcE,IAAIC,KAEL,oBAATiB,MAA0D,YAAlCC,EAAcA,iBAAGC,aAA4B,CAI9E,MAAMC,EAAS,IAAIC,MAAM,CACvBC,OAAQnB,EACRoB,WAAY,EACZC,MAAO,IACPC,MAAO,MAEHC,EAAS,IAAIL,MAAM,CACvBC,OAAQnB,EACRoB,WAAY,EACZC,MAAO,IACPC,MAAO,MAELtB,IACFC,EAASA,UAACuB,WAAWxB,EAAgB,CACnCyB,UAAW,MACXC,cAAe1B,EACf2B,eAAgB,CAACV,KAEnBhB,EAASA,UAAC2B,SAAS5B,EAAgB,CACjCyB,UAAW,MACXC,cAAe1B,EACf2B,eAAgB,CAACJ,MAGrB5B,EAAMA,OAACG,EAAsBe,QAAQR,GAAGC,GAAGC,IAC5C,CACH,GAAE"}