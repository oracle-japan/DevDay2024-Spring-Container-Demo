define(['exports', 'preact/jsx-runtime', 'preact', 'preact/compat', 'preact/hooks', './mergeProps-7be264ec', './keys-2b971df4', './collectionUtils-942f04a0', './useCurrentKey-47aecb22', './useCollectionFocusRing-be15ca1f', './useTabbableModeSet-a59bae23', './useSelection-845a2a53', './Selector-d0e8a005', './LoadMoreCollection-586ea54d', './PRIVATE_BaseCardView/themes/CardGridStyles.css', './classNames-62eaa01c', './refUtils-8d8a4660', './logger-b63acb49', './tabbableUtils-a4d6bed2', './useId-37951d4d', './useAnimation-ca55acf6', './useResizeObserver-5de04057', './TabbableModeContext-1b650f6f', './FocusTrap-d224b10e', './Grid-98c76d89', './Flex-d982a43c', './Skeleton-42bb2766'], (function(e,t,a,o,n,r,i,s,l,c,d,u,y,h,f,b,m,g,x,p,C,v,S,w,k,A,R){"use strict";const j="[data-oj-key]";const F=e=>({animationStates:{slideUp:{from:{translateY:"50px"},to:{translateY:"0px"},options:{duration:300,delay:50*e,easing:[0,0,.2,1]}},slideDown:{from:{translateY:"-50px"},to:{translateY:"0"},options:{duration:300,delay:50*e,easing:[0,0,.2,1]}}},isAnimatedOnMount:!0}),K=e=>({animationStates:{opacity:{from:{opacity:0},to:{opacity:1},options:{duration:150,delay:50*e,easing:"linear"}}},isAnimatedOnMount:!0}),M=o.memo((function({children:e,context:a,isTabbable:o,isFocused:r,isFocusRingVisible:i,isSelected:s,selectionMode:l,focusBehavior:c,setIsFocusBehaviorValid:d,initialAnimation:u,isGridLayout:y,updateCardSize:h}){const k=n.useRef(null),A=a.metadata.key,R=a.index,j=r&&i,M=f.multiVariantStyles({itemFocused:"card"===c&&j?"isItemFocused":"isNotItemFocused",itemInitialOpacity:u?"isTransparent":"isNotTransparent",itemInGridLayout:y?"isInGridLayout":"isNotInGridLayout"}),T=b.classNames([f.styles.itemStyle,M]),L=n.useCallback((e=>{h?.(e.contentRect.width,e.contentRect.height)}),[h]),B=n.useRef(null);v.useResizeObserver({ref:h?k:B,callback:L}),n.useLayoutEffect((()=>{if("content"===c&&j){const e=k.current?.firstElementChild?.firstElementChild,t=x.allTabbableElements(e,!0,!0);0===t.length||t.length>1?(g.warn(`${t.length} focusable elements are detected in the card. 'content' focusBehavior is intended only for use when the card has single focusable element. Please specify one focusable element in the card or switch the focusBehavior to 'card'.`),d?.(!1)):t[0].focus()}}),[c,j,d]);const{nodeRef:E}=C.useAnimation(u||"none",F(R)),{nodeRef:I}=C.useAnimation(u?"opacity":"none",K(R)),P=n.useMemo((()=>void 0===u?m.mergeRefs(k):m.mergeRefs(k,E,I)),[k,E,I,u]);return t.jsx("div",{id:p.useId(),ref:P,class:T,role:"gridcell","data-oj-key":A,onKeyDown:e=>{"card"!==c||!o||"ArrowDown"!==e.key&&"ArrowUp"!==e.key&&"ArrowLeft"!==e.key&&"ArrowRight"!==e.key||e.stopPropagation()},"aria-selected":"none"===l?void 0:s,..."number"==typeof A&&{"data-oj-key-type":"number"},children:t.jsx(S.TabbableModeContext.Provider,{value:{isTabbable:o},children:t.jsx(w.FocusTrap,{isDisabled:!o,restoreFocusRef:!1,children:e(a)})})})}),((e,t)=>!(!e||!t)&&(e.children===t.children&&e.isTabbable===t.isTabbable&&e.isFocused===t.isFocused&&e.isFocusRingVisible===t.isFocusRingVisible&&e.isSelected===t.isSelected&&e.initialAnimation===t.initialAnimation&&e.focusBehavior===t.focusBehavior&&s.compareListItemContext(e.context,t.context))));function T({children:e,layout:a,gap:o,columns:n}){return"grid"===a?n<1?null:t.jsx(k.Grid,{gridTemplateColumns:`repeat(${n}, 1fr)`,gap:o,children:e}):t.jsx(A.Flex,{wrap:"wrap",gap:o,children:e})}const L=(e,a=25,o,n,r=!0)=>{const i=o||("flex"===e?"60x":"100%"),s=n||"70x";return[...Array(a)].map(((e,a)=>t.jsx(R.Skeleton,{width:i,height:s},r&&`${a}${(new Date).getTime()}`)))},B=e=>t.jsx(a.Fragment,{children:L(e.layout)}),E=e=>{const o=[t.jsx("div",{class:h.LOADMORE_STYLE_CLASS,children:L(e.layout,1)}),...L(e.layout,24)];return t.jsx(a.Fragment,{children:o})},I=()=>t.jsx("div",{class:h.LOADMORE_STYLE_CLASS}),P=e=>{if(e.colCount<1||null==e.cardWidth||null==e.cardHeight)return t.jsx(I,{});{const o=[],n=e.colCount-e.totalCount%e.colCount,r=n===e.colCount,i=`calc(${e.cardWidth}px)`,s=e.cardHeight?`calc(${e.cardHeight}px)`:"70x",l="flex"===e.layout?i:"100%",c="flex"===e.layout||r?s:"100%",d=t.jsx("div",{class:h.LOADMORE_STYLE_CLASS,children:L(e.layout,1,l,c)});return o.push(d),o.push(L(e.layout,n-1,l,c)),r||o.push(L(e.layout,e.colCount,l,s)),t.jsx(a.Fragment,{children:o})}},D={all:!1,keys:new Set},V={xs:12,sm:16,md:24,lg:48,xl:64},N=o.forwardRef((({children:e,data:o,onLoadMore:b=(()=>{}),hasMore:m=!1,getRowKey:g,currentKey:x,onCurrentKeyChange:p,selectionMode:C="none",selectedKeys:v=D,onSelectionChange:S,viewportConfig:w,focusBehavior:k="card","aria-label":A,"aria-labelledby":R,initialAnimation:F="slideUp",gutterSize:K="sm",columns:L,layout:I,cardSize:N,updateCardSize:O},z)=>{const G=n.useRef(null);n.useImperativeHandle(z,(()=>G.current),[G]);const U=n.useRef(),Y=n.useRef(),_=(e=>V[e||"sm"]/4+"x")(K),$=V[K],H={layout:I,columns:L,gap:_},W=n.useRef(!0);n.useEffect((()=>{null!=N.height&&null!=N.width&&(W.current=!1)}),[N]);const X="none"===C?void 0:"multiple"===C,q=m||!o||L<1?-1:Math.ceil(o?.length/L),J=L<1?-1:L,[Q,Z]=n.useState(!0),ee=Q?k:"card",[te,ae]=d.useTabbableModeSet(G,(e=>s.keyExtractor(e,j)),x,p),{currentKeyProps:oe}=l.useCurrentKey((e=>s.keyExtractor(e,j)),"multiple"!==C,(()=>s.getPrevNextKeyByCount(o,g,x,-L)),(()=>s.getPrevNextKeyByCount(o,g,x,L)),(()=>s.getPrevNextKeyByCount(o,g,x,-1)),(()=>s.getPrevNextKeyByCount(o,g,x,1)),x,p),[ne,re]=c.useCollectionFocusRing(G,["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"]);n.useEffect((()=>{if(null!=x&&G.current){const e=s.findElementByKey(G.current,x,j);if(e&&(e.scrollIntoView({block:"nearest"}),"card"===ee)){const t=e.closest("[role=gridcell]");t&&G.current.setAttribute("aria-activedescendant",t.id)}}}),[x,o,ee]);const ie=n.useCallback((e=>{S&&(!1===e.value.all&&e.value.keys.size>0&&(U.current=Array.from(e.value.keys.values()).pop()),S(e))}),[U,S]),se=n.useCallback((e=>{if(o&&S){const t=s.handleSelectionRange(e,o,g);Array.isArray(t)&&S({value:{all:!1,keys:new Set(t)},target:null})}}),[o,S,g]),{selectionProps:le}=u.useSelection((e=>e===G.current?void 0===x?null:x:s.keyExtractor(e,j)),v,C,!1,"replace",!1,ie,U.current,x,((e,t)=>()=>s.getPrevNextKeyByCount(o,g,e,t?-L:L)),((e,t)=>()=>s.getPrevNextKeyByCount(o,g,e,t?-1:1)),(e=>{if(G.current){const t=s.findElementByKey(G.current,e,j);t&&t.scrollIntoView({block:"nearest"})}}),se),ce=n.useCallback((e=>{const a=g(e.data),o="multiple"===C?()=>t.jsx(y.Selector,{onChange:S,rowKey:a,selectedKeys:v}):void 0;return{index:e.index,data:e.data,metadata:{key:a},selector:o,isSelected:i.containsKey(v,a)}}),[C,v,S,g]),de=o&&!o.length&&m?t.jsx(E,{layout:I}):t.jsx(P,{layout:I,colCount:L,totalCount:o?.length||0,cardWidth:N.width,cardHeight:N.height});w=s.getViewportConfig(G,w);const ue=t.jsx("div",{role:"row",children:t.jsx(T,{...H,children:t.jsx(h.LoadMoreCollection,{data:o,hasMore:m,onLoadMore:b,loadMoreIndicator:de,loadMoreThreshold:$+4,viewportConfig:w,children:a=>{const o=ce(a),n=te(o.metadata.key),r=x===o.metadata.key&&!n,i=r&&ne,s=o.isSelected;return(a=>t.jsx(M,{context:a,isTabbable:n,isFocused:r,isFocusRingVisible:i,isGridLayout:"grid"===I,isSelected:s,selectionMode:C,focusBehavior:ee,..."content"===k&&{setIsFocusBehaviorValid:Z},...W.current&&{initialAnimation:F},...0===o.index&&!N.width&&{updateCardSize:O},children:e},o.metadata.key))(o)}})})}),ye=t.jsx(T,{...H,children:t.jsx(B,{layout:I})});return t.jsx("div",{...r.mergeProps(oe,re,le,{onFocus:()=>{if(!i.isKeyDefined(x)&&p&&te(void 0)&&G.current){const e=Y.current||s.getFirstVisibleKey(G.current,j);i.isKeyDefined(e)&&p({value:e})}},onPointerDown:e=>{const t=s.keyExtractor(e.target,j);i.isKeyDefined(t)&&(Y.current=t)},onKeyDown:e=>{"content"===ee&&"Tab"===e.key&&G.current?.focus({preventScroll:!0})}},{..."card"===ee&&ae}),ref:G,role:"grid",class:f.styles.baseStyle,tabIndex:0,"aria-label":A,"aria-labelledby":R,"aria-multiselectable":X,"aria-rowcount":q,"aria-colcount":J,children:o?o.length||m?ue:t.jsx(a.Fragment,{}):ye})}));e.BaseCardView=N,e.getColCount=(e,t,a)=>{if(!t||!a)return 0;const o=Math.floor((a+e)/(e+t));return Math.max(1,o)},e.gutterSizeToPX=V}));
//# sourceMappingURL=BaseCardView-f5305415.js.map
