define("oj-c/legend-item/legend-item",["require","exports","@oracle/oraclejet-preact/translationBundle","ojs/ojvcomponent"],(function(require,e,t,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.LegendItem=e.LegendItemDefaults=void 0,e.LegendItemDefaults={markerShape:"square",symbolType:"marker",borderColor:"",categories:[],lineStyle:"solid"},e.LegendItem=(0,i.registerCustomElement)("oj-c-legend-item",(({markerShape:t=e.LegendItemDefaults.markerShape,symbolType:i=e.LegendItemDefaults.symbolType,borderColor:a=e.LegendItemDefaults.borderColor,categories:n=e.LegendItemDefaults.categories,lineStyle:o=e.LegendItemDefaults.lineStyle,...r})=>null),"LegendItem",{properties:{text:{type:"string"},categories:{type:"Array<string>"},symbolType:{type:"string",enumValues:["marker","image","line","lineWithMarker"]},source:{type:"string"},color:{type:"string"},borderColor:{type:"string"},lineStyle:{type:"string",enumValues:["dashed","dotted","solid"]},lineWidth:{type:"number"},markerShape:{type:"string",enumValues:["square","circle","ellipse","diamond","human","plus","star","triangleDown","triangleUp","rectangle"]},markerColor:{type:"string"},shortDesc:{type:"string"}}},void 0,{"@oracle/oraclejet-preact":t.default})})),define("oj-c/legend-section/legend-section",["require","exports","@oracle/oraclejet-preact/translationBundle","ojs/ojvcomponent"],(function(require,e,t,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.LegendSection=e.LegendSectionDefaults=void 0,e.LegendSectionDefaults={text:""},e.LegendSection=(0,i.registerCustomElement)("oj-c-legend-section",(({text:t=e.LegendSectionDefaults.text,...i})=>null),"LegendSection",{properties:{text:{type:"string"}}},void 0,{"@oracle/oraclejet-preact":t.default})})),define("oj-c/legend/utils",["require","exports","../legend-item/legend-item","../legend-section/legend-section"],(function(require,e,t,i){"use strict";function a(e,i,a,n){const o={...t.LegendItemDefaults,...e};return{borderColor:o.borderColor,lineWidth:o.lineWidth,markerColor:o.markerColor||o.color||void 0,lineColor:o.color||void 0,markerShape:"line"!==o.symbolType?o.markerShape:"none",lineStyle:"marker"!==o.symbolType?o.lineStyle:"none","aria-label":[o.shortDesc,n].filter(Boolean).join(" ")||void 0,datatip:o.shortDesc,source:o.source,text:o.text,id:`${i};${a}`}}Object.defineProperty(e,"__esModule",{value:!0}),e.getDefaultSymbolDims=e.isTreeDataProvider=e.transformSection=e.transformItem=e.parseItemId=e.isLegendInteractive=e.getSectionStyles=e.getTextStyles=void 0,e.getTextStyles=function(e){return{textFontStyle:e?.fontStyle,textFontSize:e?.fontSize,textFontColor:e?.color,textFontWeight:e?.fontWeight,textDecoration:e?.textDecoration,textFontFamily:e?.fontFamily}},e.getSectionStyles=function(e){return{sectionTitleColor:e?.color,sectionTitleFontFamily:e?.fontFamily,sectionTitleFontSize:e?.fontSize,sectionTitleFontStyle:e?.fontStyle,sectionTitleFontWeight:e?.fontWeight,sectionTitleTextDecoration:e?.textDecoration}},e.isLegendInteractive=function(e,t,i){return"on"===e||"on"===t||"dim"===i},e.parseItemId=function(e){return e.split(";").map((e=>parseInt(e,10)))},e.transformItem=a,e.transformSection=function(e,t,n){const o={...i.LegendSectionDefaults,...e};return{items:o.items.map(((e,i)=>a(e,n,i,t))),title:o.text||o.title,id:`${n}`}},e.isTreeDataProvider=function(e){return!(!e||!e.getChildDataProvider)};e.getDefaultSymbolDims=(e,t)=>e||t?e?t?{width:t,height:e}:{width:e,height:e}:{width:t,height:t}:{width:void 0,height:void 0}})),define("oj-c/hooks/UNSAFE_useDataProvider/utils",["require","exports"],(function(require,e){"use strict";function t(e,t,i,a){const n=[...a];return e.forEach(((e,a)=>{const o={data:t[a],key:i[a]?.key,metadata:i[a]};e>=0?n.splice(e,0,o):n.push(o)})),n}async function i(e,t){const i=[],a=(await e.fetchByKeys({keys:t})).results;for(const e of t)if(a.has(e)){const t=a.get(e);i.push({...t,key:e})}return i}function a(e,t){return e.has(t)?e.get(t):-1}function n(e,t){const i=[...t];return e.sort(((e,t)=>t-e)),e.forEach((e=>{e<i.length&&i.splice(e,1)})),i}Object.defineProperty(e,"__esModule",{value:!0}),e.getUpdatedItemsFromMutationDetail=void 0,e.getUpdatedItemsFromMutationDetail=async function(e,o,r){const{add:s,remove:d,update:l}=e??{},c=new Map;for(const[e,t]of o.entries())c.set(t.key,e);let u=[...o];return d&&(u=function(e,t,i){const{indexes:o,keys:r}=e;let s=[...t];o?.length?s=n(o,s):r?.size&&(s=function(e,t,i){const o=[];return e.forEach((e=>{const t=a(i,e);-1!==t&&o.push(t)})),n(o,t)}(r,s,i));return s}(d,u,c)),s&&(u=await async function(e,n,o,r){const{addBeforeKeys:s,data:d,indexes:l,keys:c,metadata:u}=e;let g=[...n],h=d||[],p=u||[];if(0===h.length&&c?.size){const e=await i(r,c)??[];h=e.map((e=>e.data)),p=e.map((e=>e.metadata))}0===p.length&&c?.size&&(p=[...c].map((e=>({key:e}))));h.length&&(g=l?.length?t(l,h,p,g):s?.length?function(e,i,n,o){const r=[],s=[];return e.forEach((e=>{r.push(a(o,e)),s.push({key:e})})),t(r,i,s,n)}(s,h,g,o):function(e,i,a){return t(new Array(e.length).fill(-1),e,i,a)}(h,p,g));return g}(s,u,c,r)),l&&(u=await async function(e,t,n,o){const{data:r,indexes:s,keys:d,metadata:l}=e;let c=[...t],u=r||[],g=l||[];if(0===u.length&&d?.size){const e=await i(o,d)??[];u=e.map((e=>e.data)),g=e.map((e=>e.metadata))}0===g.length&&d?.size&&(g=[...d].map((e=>({key:e}))));u.length&&(s?.length?c=function(e,t,i,a){const n=[...a];return e.forEach(((e,a)=>{if(n[e]){const o={data:t[a],key:i[a]?.key,metadata:i[a]};n.splice(e,1,o)}})),n}(s,u,g,c):d?.size&&(c=function(e,t,i,n,o){const r=[...n];return e.forEach((e=>{const n=a(o,e),s={data:t[n],key:i[n]?.key,metadata:i[n]};n>=0&&r.splice(n,1,s)})),r}(d,u,g,c,n)));return c}(l,u,c,r)),u}})),define("oj-c/hooks/UNSAFE_useDataProvider/DataProviderHandler",["require","exports","./utils"],(function(require,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DataProviderHandler=void 0;e.DataProviderHandler=class{constructor(e,i,a){this.handleMutateEvent=async e=>{const{detail:i}=e,a=this.addBusyState("updating data from mutation event"),n=await(0,t.getUpdatedItemsFromMutationDetail)(i,this.currentData,this.dataProvider);a?.(),this.currentData=n,this.callback?.onDataUpdated?.(n)},this.handleRefreshEvent=()=>{this._fetchDataAndNotify()},this.addBusyState=i,this.callback=a,this.dataProvider=e,this.currentData=[],e.addEventListener("refresh",this.handleRefreshEvent),e.addEventListener("mutate",this.handleMutateEvent),this._fetchDataAndNotify()}destroy(){this.callback=void 0,this.currentData=[],this.dataProvider.removeEventListener("refresh",this.handleRefreshEvent),this.dataProvider.removeEventListener("mutate",this.handleMutateEvent)}async _fetchData(){const e=[],t=this.dataProvider.fetchFirst({size:-1});for await(const i of t){const t=i.data.map(((e,t)=>({data:e,key:i.metadata[t].key,metadata:i.metadata[t]})));e.push(...t)}return this.currentData=e.slice(),e}async _fetchDataAndNotify(){const e=this.addBusyState("fetching data"),t=await this._fetchData();this.callback?.onDataUpdated?.(t),e()}}})),define("oj-c/hooks/UNSAFE_useDataProvider/useDataProvider",["require","exports","preact/hooks","./DataProviderHandler"],(function(require,e,t,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.useDataProvider=void 0,e.useDataProvider=function({addBusyState:e,data:a}){const[n,o]=(0,t.useState)([]),r=(0,t.useRef)();return(0,t.useEffect)((()=>(void 0!==a&&(r.current=new i.DataProviderHandler(a,e,{onDataUpdated:o})),()=>{r.current?.destroy(),r.current=void 0})),[a,e]),{data:n}}})),define("oj-c/utils/UNSAFE_vizUtils/TemplateHandler",["require","exports","preact/compat"],(function(require,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.processTemplate=e.processNodeTemplate=void 0;const i=e=>Object.keys(e).reduce(((t,i)=>("children"===i||(t[(e=>e[0].toLowerCase()!==e[0]?e.toLowerCase().replace(/-./g,(e=>e[1].toUpperCase())):e)(i)]=e[i]),t)),{});e.processNodeTemplate=(e,a,n,o)=>{const r=a(n),s=t.Children.toArray(r).find((e=>{if(e&&e.props)return(e.props?.children?.type||e.type)===o})),d=s?.type===o?s.props:(s?.props?.children).props,l=e.key||e.metadata?.key;return d?{...i(d),key:l,id:l,_itemData:e.data}:{key:l,id:l,_itemData:e.data}};e.processTemplate=(t,i,a,n)=>t.map(((t,o)=>(0,e.processNodeTemplate)(t,i,a(t,o),n)))})),define("oj-c/hooks/UNSAFE_useVizCategories/useVizCategories",["require","exports","@oracle/oraclejet-preact/hooks/UNSAFE_useCategories"],(function(require,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.useVizCategories=void 0,e.useVizCategories=function(e,i,a,n,o="any",r="all",s,d){const{ids:l,updateCategories:c}=(0,t.useCategories)(e,i,a,o,!1,s),{ids:u,updateCategories:g}=(0,t.useCategories)(e,i,n,r,!0,d);return{hiddenIds:l,updateHidden:c,highlightedIds:u,updateHighlighted:g}}})),define("oj-c/legend/events",["require","exports","./utils"],(function(require,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.getLegendEventsHandler=void 0;e.getLegendEventsHandler=(e,i,a,n,o,r="off",s)=>({itemActionHandler:i=>{e?a(i.itemId):"on"===r&&s?.({id:o((0,t.parseItemId)(i.itemId))})},inputHandler:e=>{i&&n(e.itemId)}})})),define("oj-c/legend/useSectionData",["require","exports","preact/compat","../utils/UNSAFE_vizUtils/TemplateHandler","../hooks/UNSAFE_useDataProvider/useDataProvider","ojs/ojflattenedtreedataproviderview","ojs/ojkeyset"],(function(require,e,t,i,a,n,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.useSectionData=void 0,e.useSectionData=function(e,r,s,d){const l=(0,t.useRef)(e),c=(0,t.useRef)(new n(e,{expanded:new o.AllKeySetImpl}));l.current!=e&&(l.current=e,c.current=new n(l.current,{expanded:new o.AllKeySetImpl}));const{data:u}=(0,a.useDataProvider)({data:c.current,addBusyState:r}),g=[];if(u.length>0){let e;for(const t of u){const a={key:t.metadata?.key,data:t.data,index:t.metadata.indexFromParent};if(0===t?.metadata?.treeDepth){e=t;let n=t.data;const o=[];s&&(n=(0,i.processNodeTemplate)(t,s,a,"oj-c-legend-section")),g.push({...n,items:o})}else{const n={...a,parentKey:t.metadata?.parentKey,parentData:e?.data},o=d?(0,i.processNodeTemplate)(t,d,n,"oj-c-legend-item"):t.data;g[g.length-1].items.push({key:t.metadata?.key,...o})}}}return g}})),define("oj-c/legend/legend",["require","exports","preact/jsx-runtime","@oracle/oraclejet-preact/translationBundle","preact/hooks","@oracle/oraclejet-preact/UNSAFE_Legend","ojs/ojcontext","ojs/ojvcomponent","./utils","../hooks/UNSAFE_useDataProvider/useDataProvider","../utils/UNSAFE_vizUtils/TemplateHandler","@oracle/oraclejet-preact/hooks/UNSAFE_useTranslationBundle","preact/compat","../hooks/UNSAFE_useVizCategories/useVizCategories","./events","./useSectionData","css!oj-c/legend/legend-styles.css"],(function(require,e,t,i,a,n,o,r,s,d,l,c,u,g,h,p){"use strict";function y({hoverBehavior:e,hideAndShowBehavior:i,hiddenCategories:a,highlightedCategories:o,onHiddenCategoriesChanged:r,onHighlightedCategoriesChanged:p,drilling:y,itemTemplate:m,sectionTemplate:f,textStyle:v,orientation:S,symbolHeight:D,symbolWidth:b,...j}){const{data:k}=(0,d.useDataProvider)({data:j.data?j.data:void 0,addBusyState:j.addBusyState}),C="dim"===e,x="on"===i,T=(0,s.isLegendInteractive)(y,i,e),_=(0,c.useTranslationBundle)("@oracle/oraclejet-preact"),I=m?(0,l.processTemplate)(k,m,((e,t)=>({data:e.data,key:e.key,index:t})),"oj-c-legend-item"):k.map((e=>e.data)),L=(0,u.useMemo)((()=>I.map(((e,t)=>(0,s.transformItem)(e,0,t,"on"===y?_.viz_drillable():"")))),[I,y,_]),P=(0,u.useMemo)((()=>{const e=[];return(x||C)&&I.forEach(((t,i)=>{e.push({id:L[i].id,categories:t.categories||[]})})),e}),[L,I,x,C]),{hiddenIds:E,updateHidden:H,highlightedIds:B,updateHighlighted:A}=(0,g.useVizCategories)(P,(e=>e.categories),a,o,"any","any",r,p),{itemActionHandler:w,inputHandler:F}=(0,h.getLegendEventsHandler)(x,C,H,A,(e=>{const[t,i]=e,a=I[i];return a.categories?.length>0?a.categories:k[i].metadata?.key}),y,j.onOjDrill),z=(0,s.getTextStyles)(v);return 0!==L.length?(0,t.jsx)(n.Legend,{orientation:S,symbolHeight:D,symbolWidth:b,isReadOnly:!T,hiddenIds:x?E:void 0,highlightedIds:C?B:void 0,items:L,onItemAction:w,onInput:F,...j,...z}):null}function m({hoverBehavior:e,hideAndShowBehavior:i,hiddenCategories:a,highlightedCategories:o,onHiddenCategoriesChanged:r,onHighlightedCategoriesChanged:d,drilling:l,itemTemplate:y,sectionTemplate:m,textStyle:f,sectionTitleStyle:v,orientation:S,symbolHeight:D,symbolWidth:b,data:j,...k}){const C="dim"===e,x="on"===i,T=(0,s.isLegendInteractive)(l,i,e),_=(0,c.useTranslationBundle)("@oracle/oraclejet-preact"),I=(0,p.useSectionData)(j,k.addBusyState,m,y),L=(0,u.useMemo)((()=>I.map(((e,t)=>(0,s.transformSection)(e,"on"===l?_.viz_drillable():"",t)))),[I,l,_]),P=(0,u.useMemo)((()=>{const e=[];return(x||C)&&I.forEach(((t,i)=>{t.items.forEach(((t,a)=>{e.push({id:L[i].items[a].id,categories:t.categories||[]})}))})),e}),[I,x,C,L]),{hiddenIds:E,updateHidden:H,highlightedIds:B,updateHighlighted:A}=(0,g.useVizCategories)(P,(e=>e.categories),a,o,"any","any",r,d),{itemActionHandler:w,inputHandler:F}=(0,h.getLegendEventsHandler)(x,C,H,A,(e=>{const[t,i]=e,a=I[t].items[i];return a.categories?a.categories:a.key}),l,k.onOjDrill),z=(0,s.getTextStyles)(f),U=(0,s.getSectionStyles)(v);return 0!==L.length?(0,t.jsx)(n.SectionalLegend,{sections:L,orientation:S,sectionTitleHAlign:k.sectionTitleHalign,symbolHeight:D,symbolWidth:b,isReadOnly:!T,"aria-label":k["aria-label"],"aria-describedBy":k["aria-describedby"],"aria-labelledBy":k["aria-labelledby"],hiddenIds:x?E:void 0,highlightedIds:C?B:void 0,onItemAction:w,onInput:F,...z,...U}):null}Object.defineProperty(e,"__esModule",{value:!0}),e.LinearLegend=e.Legend=void 0,e.Legend=(0,r.registerCustomElement)("oj-c-legend",(function({data:e=null,drilling:i="off",halign:n="start",valign:d="top",hiddenCategories:l=[],hideAndShowBehavior:c="off",highlightedCategories:u=[],hoverBehavior:g="none",orientation:h="vertical",symbolHeight:p=0,symbolWidth:f=0,textStyle:v={},sectionTitleStyle:S={},sectionTitleHalign:D="start",...b}){const j=(0,a.useRef)(null),k=(0,a.useCallback)((e=>j.current?o.getContext(j.current).getBusyContext().addBusyState({description:`oj-c-legend: ${e}`}):()=>{}),[]),C=(0,s.isTreeDataProvider)(e),{width:x,height:T}=(0,s.getDefaultSymbolDims)(p,f);return(0,t.jsx)(r.Root,{ref:j,class:`oj-c-legend-${n} oj-c-legend-${d}`,children:C?(0,t.jsx)(m,{data:e,...b,addBusyState:k,drilling:i,hiddenCategories:l,hideAndShowBehavior:c,highlightedCategories:u,hoverBehavior:g,orientation:h,symbolHeight:T,symbolWidth:x,textStyle:v,sectionTitleStyle:S,sectionTitleHalign:D}):(0,t.jsx)(y,{...b,data:e,drilling:i,hiddenCategories:l,hideAndShowBehavior:c,highlightedCategories:u,hoverBehavior:g,orientation:h,symbolHeight:T,symbolWidth:T,addBusyState:k,textStyle:v})})}),"Legend",{properties:{data:{type:"DataProvider|null"},drilling:{type:"string",enumValues:["off","on"]},halign:{type:"string",enumValues:["center","end","start"]},hiddenCategories:{type:"Array<string>",writeback:!0},hideAndShowBehavior:{type:"string",enumValues:["off","on"]},highlightedCategories:{type:"Array<string>",writeback:!0},hoverBehavior:{type:"string",enumValues:["none","dim"]},orientation:{type:"string",enumValues:["horizontal","vertical"]},symbolHeight:{type:"number"},symbolWidth:{type:"number"},textStyle:{type:"object",properties:{color:{type:"string"},fontFamily:{type:"string"},fontSize:{type:"string"},fontStyle:{type:"string"},fontWeight:{type:"string"},textDecoration:{type:"string"}}},valign:{type:"string",enumValues:["top","bottom","middle"]},sectionTitleStyle:{type:"object",properties:{color:{type:"string"},fontFamily:{type:"string"},fontSize:{type:"string"},fontStyle:{type:"string"},fontWeight:{type:"string"},textDecoration:{type:"string"}}},sectionTitleHalign:{type:"string",enumValues:["center","end","start"]}},slots:{itemTemplate:{data:{}},sectionTemplate:{data:{}}},events:{ojDrill:{}},extension:{_WRITEBACK_PROPS:["hiddenCategories","highlightedCategories"],_READ_ONLY_PROPS:[],_OBSERVED_GLOBAL_PROPS:["aria-label","aria-describedby","aria-labelledby"]}},{data:null,drilling:"off",halign:"start",valign:"top",hiddenCategories:[],hideAndShowBehavior:"off",highlightedCategories:[],hoverBehavior:"none",orientation:"vertical",symbolHeight:0,symbolWidth:0,textStyle:{},sectionTitleStyle:{},sectionTitleHalign:"start"},{"@oracle/oraclejet-preact":i.default}),e.LinearLegend=y}));
//# sourceMappingURL=legend.js.map