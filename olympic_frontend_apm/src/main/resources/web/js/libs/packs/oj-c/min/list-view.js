define("oj-c/utils/UNSAFE_keyUtils/keySetUtils",["require","exports","ojs/ojkeyset"],(function(require,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.keysToKeySet=e.keySetToKeys=void 0;e.keySetToKeys=e=>{if(!e)return{all:!1,keys:new Set};let t={};if(e.isAddAll()){t={all:!0,deletedKeys:new Set(e.deletedValues())}}else if(!e.isAddAll()){t={all:!1,keys:new Set(e.values())}}return t};e.keysToKeySet=e=>{let a;return e.all?(a=new t.AllKeySetImpl,a=a.delete(new Set(e.deletedKeys.values()))):e.all||(a=new t.KeySetImpl(new Set(e.keys.values()))),a}})),define("oj-c/hooks/UNSAFE_useListData/useListData",["require","exports","ojs/ojdataproviderfactory","preact/hooks"],(function(require,e,t,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.useListData=void 0;const s=Object.freeze({status:"loading",data:null}),r={isInitialFetchDeferred:!1};e.useListData=(e,t=r)=>{const l=(0,a.useRef)(null),u=(0,a.useRef)(0),d=(0,a.useRef)(!1),h=(0,a.useRef)(null),m=(0,a.useRef)(null),p=t.fetchSize&&t.fetchSize>0?t.fetchSize:25;if(!e){return[c("exact"),e=>Promise.resolve()]}const v=(0,a.useMemo)((()=>i(e)),[e]),[g,j]=(0,a.useReducer)(n,0===t.initialRowsFetched?c("atLeast"):s),S=(0,a.useCallback)((async(e,a)=>{const s={attributes:t.attributes,sortCriteria:t.sortCriteria,filterCriterion:t.filterCriterion,offset:e.offset,size:e.count},r=!0===d.current?"exact":"atLeast";if(0!==e.count)try{const t=(await v.fetchByOffset(s)).results;a&&a(t),j({status:"success",data:{offset:e.offset,data:t,totalSize:u.current,sizePrecision:r}})}catch(e){j({status:"error",error:e})}else j({status:"success",data:{offset:e.offset,data:[],totalSize:u.current,sizePrecision:r}})}),[v,t.attributes,t.filterCriterion,t.sortCriteria]),w=(0,a.useCallback)((async()=>{j({status:"loading",data:null});const e=new AbortController;m.current=e;const a=v.fetchFirst({attributes:t.attributes,sortCriteria:t.sortCriteria,filterCriterion:t.filterCriterion,size:p,signal:e.signal})[Symbol.asyncIterator]();h.current=a;try{const e=await a.next(),s=e.value.fetchParameters;if(s.signal&&s.signal.aborted)return;u.current=e.value.data.length,void 0!==e.done&&(d.current=e.done);const r=t.initialRowsFetched&&t.initialRowsFetched>0?t.initialRowsFetched:p;S({offset:0,count:Math.min(u.current,r)})}catch(e){if(e instanceof DOMException&&"AbortError"===e.name)return;j({status:"error",error:e}),h.current=null}}),[v,S,t.attributes,t.filterCriterion,t.sortCriteria,t.fetchSize]),C=(0,a.useCallback)((async e=>{if(null===h.current)w();else{const t=e.offset+e.count;if(t>u.current){if(null==l.current){const a=o(h,u.current,t);l.current=a;try{const t=await a;void 0!==t.done&&(d.current=t.done);const s=t.total;s>0&&(u.current=s,S({offset:e.offset,count:Math.min(u.current-e.offset,e.count)})),l.current=null}catch(e){j({status:"error",error:e}),l.current=null}}}else S(e)}}),[g,w,S]),k=(0,a.useCallback)((()=>{h.current=null,l.current=null,u.current=0,d.current=!1,0===t.initialRowsFetched?j(c("atLeast")):t.isInitialFetchDeferred?j({status:"loading",data:null}):w()}),[w,t.isInitialFetchDeferred,t.initialRowsFetched]);(0,a.useEffect)((()=>{k()}),[k]);const x=(0,a.useCallback)((e=>{if("success"===g.status&&g.data){const a=g.data;let s,r=!1;if(e.detail.add){const s=f(e.detail.add,a,t,!0);u.current=u.current+s,r=s>0||"exact"===a.sizePrecision,0===s&&(d.current=!1)}if(e.detail.remove){const s=f(e.detail.remove,a,t,!1);u.current=u.current-s,r=r||s>0}const i=e.detail.update;i&&(r=r||y(i,a,t),s=e=>{b(i,a,e)}),r&&S({offset:a.offset,count:a.data.length},s)}}),[g,t,S]),L=(0,a.useCallback)((e=>{let t=-1;const a=e.detail?.disregardAfterKey;if(a&&"success"===g.status){const e=g.data.data.findIndex((e=>e.metadata.key===a));if(e>-1&&(t=g.data.data.length-e-1),0===t&&g.data.data.length>=p)return}t>-1&&"success"===g.status?(u.current=u.current-t,C({offset:g.data.offset,count:Math.max(g.data.data.length,p)})):("loading"===g.status&&m.current?.abort(),k())}),[g,k]);return(0,a.useEffect)((()=>(v.addEventListener("refresh",L),v.addEventListener("mutate",x),()=>{v.removeEventListener("refresh",L),v.removeEventListener("mutate",x)})),[v,k,x]),[g,C]};const i=e=>(0,t.getEnhancedDataProvider)(e,{fetchFirst:{caching:"visitedByCurrentIterator"}}),n=(e,t)=>e.status===t.status&&"loading"===t.status?e:t,o=async(e,t,a)=>await l(e,t,a),l=async(e,t,a)=>{const s=e.current;if(null===s)return{total:-1,done:void 0};const r=await s.next();return s===e.current?(t+=r.value.data.length)>=a||r.done?{total:t,done:r.done}:l(e,t,a):{total:-1,done:void 0}},c=e=>"atLeast"===e?u:d,u=Object.freeze({status:"success",data:{offset:0,data:[],totalSize:0,sizePrecision:"atLeast"}}),d=Object.freeze({status:"success",data:{offset:0,data:[],totalSize:0,sizePrecision:"exact"}}),f=(e,t,a,s)=>{let r=0;if(h(e,a)){const a=s?e.indexes?.sort():e.indexes;let i=t.totalSize-1;a?.forEach((e=>{e<=i&&(r=r+=1,s&&(i=i+=1))}))}return r},y=(e,t,a)=>{if(h(e,a)){const a=e.indexes?e.indexes:[],s=t.offset,r=s+t.data.length;for(let e=0;e<a.length;e++)if(a[e]>=s&&a[e]<r)return!0}return!1},b=(e,t,a)=>{e.keys.forEach((e=>{const s=a.find((t=>t.metadata.key==e)),r=t.data.find((t=>t.metadata.key==e));r&&s&&r.data===s.data&&(s.data=new Proxy(s.data,{}))}))},h=(e,t)=>e.indexes&&null==t.sortCriteria&&null==t.filterCriterion})),define("oj-c/list-view/useHandleRemoveCurrentKey",["require","exports","preact/hooks"],(function(require,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.useHandleRemoveCurrentKey=void 0,e.useHandleRemoveCurrentKey=function(e,a,s){const r=(0,t.useRef)();(0,t.useEffect)((()=>{const t=r.current;if(a&&s&&t&&e&&t.offset===e.offset&&t!==e){const r=e.data.map((e=>e.metadata.key));if(-1===r.indexOf(a)){const e=t?.data.map((e=>e.metadata.key));let i=e.indexOf(a);if(i>-1){const t=i===e.length-1;for(;i>=0&&i<e.length;){i=t?i-1:i+1;const a=e[i];if(r.indexOf(a)>-1){s({value:a});break}}}}}r.current=e}),[e,a,s])}})),define("oj-c/list-view/useListViewPreact",["require","exports","preact/hooks","../utils/UNSAFE_keyUtils/keySetUtils","../hooks/UNSAFE_useListData/useListData","./useHandleRemoveCurrentKey"],(function(require,e,t,a,s,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.useListViewPreact=void 0;e.useListViewPreact=({"aria-label":e,"aria-labelledby":i,data:n,gridlines:o,onCurrentItemChanged:l,selectionMode:c,selected:u,scrollPolicyOptions:d,onSelectedChanged:f,onOjItemAction:y},b,h)=>{const m=(0,t.useRef)(),[p,v]=(0,s.useListData)(n,{fetchSize:d?.fetchSize}),g=(0,a.keySetToKeys)(u),j="error"!==p.status?p.data:null,[S,w]=(0,t.useState)();(0,t.useEffect)((()=>{"loading"===p.status?m.current=b("list data is in fetch state"):m.current&&(m.current(),m.current=void 0)}),[p.status,b]);const C=e=>{w(e.value),l&&l(e.value)},k="error"===p.status?null:p.data;(0,r.useHandleRemoveCurrentKey)(k,S,C);const x=d?.scroller?{scroller:()=>d.scroller?document.querySelector(d.scroller):null}:void 0,L=(0,t.useMemo)((()=>function(e){if("success"!==e.status)return{count:0};const t=e.data.data;let a=0;for(let e=0;e<t.length&&null!=t[e].metadata.suggestion;e++)a+=1;return{count:a}}(p)),[p]),P=(0,t.useCallback)((()=>{if(j){const e=d&&d.fetchSize?d.fetchSize:25;v({offset:0,count:j.data.length+e})}}),[d,v,j]);return{status:p.status,listViewProps:{"aria-label":e,"aria-labelledby":i,data:j?j.data:null,currentKey:S,getRowKey:e=>e.metadata.key,gridlines:o,onCurrentKeyChange:C,hasMore:!!j&&"atLeast"===j.sizePrecision,onLoadMore:P,onSelectionChange:e=>{f&&!h(e.target)&&f((0,a.keysToKeySet)(e.value))},selectedKeys:g,selectionMode:c,promotedSection:L,onItemAction:e=>{const t=e.context.data,a={context:{item:t,data:t.data}};y&&y(a)},viewportConfig:x}}}})),define("oj-c/list-view/listViewItem",["require","exports","preact/jsx-runtime","@oracle/oraclejet-preact/hooks/UNSAFE_useTabbableMode","@oracle/oraclejet-preact/hooks/UNSAFE_useTranslationBundle"],(function(require,e,t,a,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ListItem=void 0;e.ListItem=({context:e,itemTemplate:r})=>{const{isTabbable:i}=(0,a.useTabbableMode)(),n=(0,s.useTranslationBundle)("@oracle/oraclejet-preact"),o={isTabbable:i,data:e.data.data,item:e.data};return(0,t.jsxs)(a.TabbableModeContext.Provider,{value:{isTabbable:i},children:[r&&r(o),o.item.metadata?.suggestion&&(0,t.jsx)("span",{class:"oj-helper-hidden-accessible",children:n.list_suggestion()})]})}})),define("oj-c/list-view/list-view",["require","exports","preact/jsx-runtime","@oracle/oraclejet-preact/translationBundle","ojs/ojcontext","ojs/ojvcomponent","preact/compat","preact/hooks","@oracle/oraclejet-preact/UNSAFE_EmptyList","@oracle/oraclejet-preact/UNSAFE_ListView","@oracle/oraclejet-preact/hooks/UNSAFE_useTranslationBundle","./useListViewPreact","./listViewItem","css!oj-c/list-view/list-view-styles.css"],(function(require,e,t,a,s,r,i,n,o,l,c,u,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ListView=void 0;const f=({addBusyState:e,isClickthroughDisabled:a,itemTemplate:s,noData:r,...n})=>{const{status:f,listViewProps:y}=(0,u.useListViewPreact)(n,e,a),b=(0,c.useTranslationBundle)("@oracle/oraclejet-preact");if("success"===f&&!y.hasMore&&0===y.data?.length){if(r)return(0,t.jsx)(o.EmptyList,{"aria-label":y["aria-label"],"aria-labelledby":y["aria-labelledby"],children:r(i.Children)});{const e=b.noData_message();return(0,t.jsx)(o.EmptyList,{"aria-label":y["aria-label"],"aria-labelledby":y["aria-labelledby"],children:e})}}return(0,t.jsx)(l.ListView,{...y,children:e=>(0,t.jsx)(d.ListItem,{context:e,itemTemplate:s})})};e.ListView=(0,r.registerCustomElement)("oj-c-list-view",(({selectionMode:e="none",...a})=>{const i=(0,n.useRef)(),o=(0,n.useRef)(s.getContext(i.current).getBusyContext()),l=(0,n.useCallback)((e=>o.current?.addBusyState({description:`oj-c-list-view: ${e}`})),[]),c=(0,n.useCallback)((e=>null!==e&&void 0!==i.current&&y({target:e},i.current)),[]),u={selectionMode:e,...a};return(0,t.jsx)(r.Root,{id:u.id,ref:i,children:(0,t.jsx)(f,{addBusyState:l,isClickthroughDisabled:c,...u})})}),"ListView",{properties:{currentItem:{type:"any",readOnly:!0,writeback:!0},data:{type:"DataProvider|null"},gridlines:{type:"object",properties:{item:{type:"string",enumValues:["hidden","visible"]},top:{type:"string",enumValues:["hidden","visible"]},bottom:{type:"string",enumValues:["hidden","visible"]}}},scrollPolicyOptions:{type:"object",properties:{fetchSize:{type:"number"},scroller:{type:"string"}}},selected:{type:"object",writeback:!0},selectionMode:{type:"string",enumValues:["none","multiple","single"]}},slots:{itemTemplate:{data:{}},noData:{data:{}}},events:{ojItemAction:{}},extension:{_WRITEBACK_PROPS:["currentItem","selected"],_READ_ONLY_PROPS:["currentItem"],_OBSERVED_GLOBAL_PROPS:["aria-label","aria-labelledby","id"]}},{selectionMode:"none"},{"@oracle/oraclejet-preact":a.default});const y=function(e,t){let a=e.target;for(;null!=a&&a!==t;){if(b(a))return!0;a=a.parentNode}return!1},b=function(e){return"disabled"===e.dataset.ojClickthrough}}));
//# sourceMappingURL=list-view.js.map